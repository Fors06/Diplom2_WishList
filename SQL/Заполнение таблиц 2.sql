USE SupportManager;
GO

-- Очистка таблиц (если нужно пересоздать данные)
DELETE FROM Tasks;
DELETE FROM WorkPlans;
DELETE FROM TaskProgress;
DELETE FROM TaskCategories;
DELETE FROM Clients;
DELETE FROM Employees;
DELETE FROM EmployeeRoles;
DELETE FROM TaskPriorities;
DELETE FROM TaskStatuses;
GO

-- Заполнение ENUM-таблиц
INSERT INTO TaskStatuses (Id, Name, Description) VALUES
(0, 'New', 'Новая задача'),
(1, 'InProgress', 'В работе'),
(2, 'Testing', 'Тестирование'),
(3, 'Completed', 'Завершена'),
(4, 'OnHold', 'На паузе'),
(5, 'Cancelled', 'Отменена');

INSERT INTO TaskPriorities (Id, Name, Description) VALUES
(0, 'Low', 'Низкий приоритет'),
(1, 'Medium', 'Средний приоритет'),
(2, 'High', 'Высокий приоритет'),
(3, 'Critical', 'Критический приоритет'),
(4, 'Urgent', 'Срочный приоритет');

INSERT INTO EmployeeRoles (Id, Name, Description) VALUES
(1, 'Admin', 'Администратор системы'),
(2, 'Manager', 'Менеджер проектов'),
(3, 'Programmer', 'Программист'),
(4, 'Tester', 'Тестировщик'),
(5, 'Support', 'Техническая поддержка');

-- Заполнение сотрудников
INSERT INTO Employees (FirstName, LastName, Email, PasswordHash, RoleId) VALUES
('Алексей', 'Иванов', 'admin@company.com', '$2a$10$rOzZJkZkYVYV7B8eQ9bQ3eQY9zQ9zQ9zQ9zQ9zQ9zQ9zQ9zQ9zQ9', 1),
('Мария', 'Петрова', 'manager@company.com', '$2a$10$rOzZJkZkYVYV7B8eQ9bQ3eQY9zQ9zQ9zQ9zQ9zQ9zQ9zQ9zQ9zQ9', 2),
('Дмитрий', 'Сидоров', 'programmer1@company.com', '$2a$10$rOzZJkZkYVYV7B8eQ9bQ3eQY9zQ9zQ9zQ9zQ9zQ9zQ9zQ9zQ9zQ9', 3),
('Елена', 'Козлова', 'programmer2@company.com', '$2a$10$rOzZJkZkYVYV7B8eQ9bQ3eQY9zQ9zQ9zQ9zQ9zQ9zQ9zQ9zQ9zQ9', 3),
('Сергей', 'Федоров', 'tester@company.com', '$2a$10$rOzZJkZkYVYV7B8eQ9bQ3eQY9zQ9zQ9zQ9zQ9zQ9zQ9zQ9zQ9zQ9', 4),
('Ольга', 'Николаева', 'support@company.com', '$2a$10$rOzZJkZkYVYV7B8eQ9bQ3eQY9zQ9zQ9zQ9zQ9zQ9zQ9zQ9zQ9zQ9', 5);

-- Заполнение клиентов
INSERT INTO Clients (CompanyName, ContactPerson, Email, Phone, Address) VALUES
('ООО "ТехноПрофи"', 'Иван Сидоров', 'tech@technoprofi.ru', '+7-495-123-45-67', 'Москва, ул. Ленина, д. 15'),
('АО "Инновации"', 'Петр Иванов', 'info@innovation.ru', '+7-495-234-56-78', 'Москва, пр-т Мира, д. 25'),
('ИП "Вектор"', 'Анна Смирнова', 'vector@mail.ru', '+7-495-345-67-89', 'Москва, ул. Пушкина, д. 10'),
('ЗАО "СтройГарант"', 'Михаил Козлов', 'build@stroygarant.ru', '+7-495-456-78-90', 'Москва, ш. Энтузиастов, д. 45'),
('ООО "ТоргСервис"', 'Екатерина Волкова', 'sales@torgservice.ru', '+7-495-567-89-01', 'Москва, ул. Тверская, д. 30');

-- Заполнение категорий задач
INSERT INTO TaskCategories (Name, Description) VALUES
('Разработка', 'Задачи по разработке нового функционала'),
('Исправление ошибок', 'Исправление обнаруженных багов'),
('Тестирование', 'Тестирование функционала'),
('Документация', 'Написание технической документации'),
('Поддержка', 'Техническая поддержка пользователей'),
('Оптимизация', 'Оптимизация производительности');

-- Заполнение планов работ (ВСЕ планы сначала)
INSERT INTO WorkPlans (PlanDescription, TestSteps, EstimatedHours) VALUES
('Разработать модуль авторизации', 
 '1. Создать форму входа
2. Реализовать проверку учетных данных
3. Настроить систему сессий
4. Протестировать безопасность', 16.5),

('Исправить ошибку в отчетах', 
 '1. Проанализировать проблему
2. Найти причину ошибки
3. Исправить код
4. Протестировать исправление', 8.0),

('Создать API для мобильного приложения', 
 '1. Разработать структуру API
2. Реализовать endpoints
3. Написать документацию
4. Протестировать работу API', 24.0),

('Обновить базу данных', 
 '1. Создать миграции
2. Обновить схемы таблиц
3. Перенести данные
4. Протестировать целостность', 12.5),

('Оптимизировать загрузку страниц', 
 '1. Проанализировать производительность
2. Оптимизировать запросы к БД
3. Кэшировать данные
4. Измерить улучшения', 10.0),

('Тестирование платежного модуля', 
 '1. Проверить обработку успешных платежей
2. Проверить обработку неудачных платежей
3. Тестирование отката транзакций
4. Проверка безопасности', 8.0),

('Документирование API методов', 
 '1. Описать все endpoints
2. Добавить примеры запросов/ответов
3. Описать коды ошибок
4. Создать руководство по использованию', 6.0),

('Поддержка пользователей', 
 '1. Обучение новых пользователей
2. Консультации по функционалу
3. Решение технических проблем
4. Сбор обратной связи', 4.0);

-- Заполнение прогресса задач
INSERT INTO TaskProgress (Description, ProgressPercentage, HoursSpent) VALUES
('Начало разработки модуля авторизации', 25, 4.0),
('Анализ проблемы с отчетами', 50, 4.0),
('Проектирование структуры API', 10, 2.5),
('Подготовка миграций базы данных', 30, 3.5),
('Анализ текущей производительности', 20, 2.0),
('Завершено тестирование модуля', 100, 12.0),
('Исправлены критические ошибки', 75, 6.5),
('Документация готова к ревью', 90, 8.0);

-- Теперь заполняем задачи с правильными WorkPlansId
INSERT INTO Tasks (Title, Description, ClientId, CategoryId, ManagerId, ProgrammerId, StatusId, PriorityId, TaskProgressId, WorkPlansId, DueDate, EstimatedHours, ActualHours) VALUES
('Разработка системы авторизации', 
 'Необходимо разработать безопасную систему авторизации с поддержкой ролей', 
 1, 1, 2, 3, 1, 2, 1, 1, DATEADD(day, 14, GETDATE()), 16.5, 4.0),

('Исправление ошибки в финансовых отчетах', 
 'В отчете за последний квартал некорректно отображаются итоговые суммы', 
 2, 2, 2, 4, 1, 3, 2, 2, DATEADD(day, 7, GETDATE()), 8.0, 4.0),

('Создание REST API для мобильного приложения', 
 'Разработать API для синхронизации данных с мобильным приложением', 
 3, 1, 2, 3, 0, 2, 3, 3, DATEADD(day, 21, GETDATE()), 24.0, 2.5),

('Миграция базы данных на новую версию', 
 'Обновить структуру БД и перенести существующие данные', 
 4, 6, 2, 4, 1, 1, 4, 4, DATEADD(day, 10, GETDATE()), 12.5, 3.5),

('Оптимизация скорости загрузки каталога', 
 'Ускорить загрузку страницы каталога товаров', 
 5, 6, 2, 3, 0, 2, 5, 5, DATEADD(day, 5, GETDATE()), 10.0, 2.0),

('Тестирование платежного модуля', 
 'Полное тестирование функционала оплаты и обработки транзакций', 
 1, 3, 2, 5, 3, 1, 6, 6, DATEADD(day, 3, GETDATE()), 8.0, 12.0),

('Документирование API методов', 
 'Создание подробной документации для всех API endpoints', 
 2, 4, 2, 4, 2, 1, 7, 7, DATEADD(day, 7, GETDATE()), 6.0, 6.5),

('Поддержка пользователей', 
 'Консультация пользователей по работе с системой', 
 3, 5, 2, 6, 1, 0, 8, 8, DATEADD(day, 1, GETDATE()), 4.0, 8.0);